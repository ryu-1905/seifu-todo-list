<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TaskFlow</title>
    <link rel="stylesheet" href="../static/taskflow_search.css">
</head>

<body>

    <div class="task-container">

        <div class="task-card">

            <div class="task-header">
                <h2>TaskFlow</h2>
                <button class="logout-btn">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>

            <div class="search-area">
                <input type="text" id="searchInput" placeholder="search..." oninput="searchTask()">
            </div>

            <div class="task-list" id="taskList">
                <!-- Task s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JS -->
            </div>
            <!-- N√∫t th√™m task -->
            <button class="add-btn" onclick="goToAddTask()">Ôºã</button>

        </div>

    </div>
	


<script>
// ================== CHUY·ªÇN ƒê·∫æN TRANG TH√äM TASK ==================
function goToAddTask() {
    localStorage.removeItem("editTaskIndex"); // X√≥a index s·ª≠a ƒë·ªÉ trang giay2 bi·∫øt l√† th√™m m·ªõi
    window.location.href = "addtask.html";
}

// ================== LOAD TASKS T·ª™ LOCALSTORAGE ==================
document.addEventListener("DOMContentLoaded", () => {
    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    tasks.forEach((task, index) => createTaskItem(task, index));
});

// ================== T·∫†O PH·∫¶N T·ª¨ TASK ==================
function createTaskItem(task, index) {
    let taskList = document.getElementById("taskList");

    let div = document.createElement("div");
    div.className = "task-item";

    // Hi·ªÉn th·ªã ng√†y gi·ªù
    let timeDisplay = task.date;
    if (task.time) {
        timeDisplay += " " + task.time;
    }

    // X·ª≠ l√Ω n·ªôi dung n·∫øu ch∆∞a c√≥
    let content = task.content || "";

    div.innerHTML = `
        <input type="checkbox">
        <div class="task-info">
            <div class="task-title">${task.title}</div>
            <div class="task-content">${content}</div>
            <div class="task-time">${timeDisplay}</div>
        </div>
        <div class="task-actions">
            <button class="edit" onclick="editTask(${index})">‚úèÔ∏è</button>
            <button class="delete" onclick="deleteTask(this)">üóëÔ∏è</button>
        </div>
    `;

    taskList.appendChild(div);
}

// ================== X√ìA TASK ==================
function deleteTask(btn) {
    // X√≥a kh·ªèi giao di·ªán
    let item = btn.closest(".task-item");
    item.remove();
    
    // TODO: C·∫ßn c·∫≠p nh·∫≠t l·∫°i localStorage n·∫øu mu·ªën x√≥a vƒ©nh vi·ªÖn
    // Hi·ªán t·∫°i ch·ªâ x√≥a tr√™n giao di·ªán theo y√™u c·∫ßu lu·ªìng ch√≠nh
}

// ================== S·ª¨A TASK ==================
function editTask(index) {
    // L∆∞u ch·ªâ s·ªë task c·∫ßn s·ª≠a v√†o localStorage
    localStorage.setItem("editTaskIndex", index);
    // Chuy·ªÉn sang trang addtask.html
    window.location.href = "addtask.html";	
}

// ================== T√åM KI·∫æM TASK ==================
function searchTask() {
    let keyword = document.getElementById("searchInput").value.toLowerCase();
    let tasks = document.querySelectorAll(".task-item");

    tasks.forEach(task => {
        let title = task.querySelector(".task-title").innerText.toLowerCase();
        let content = task.querySelector(".task-content").innerText.toLowerCase();
        
        if (title.includes(keyword) || content.includes(keyword)) {
            task.style.display = "flex";
        } else {
            task.style.display = "none";
        }
    });
}
</script>

</body>
</html>
