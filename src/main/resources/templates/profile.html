<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Profile</title>
    <link th:href="@{/css/profile.css}" rel="stylesheet" />
  </head>

  <body>
    <div class="container">
      <form class="card" method="post" th:action="@{/profile}">
        <h1 class="title">プロフィール情報</h1>

        <input type="hidden" name="id" th:value="${account.id}" />

        <!-- USERNAME -->
        <div class="profile-group">
          <label>ユーザー名</label>
          <div class="profile-value" th:text="${account.username}"></div>
          <input class="profile-input" type="text" name="username" hidden />
        </div>

        <!-- EMAIL -->
        <div class="profile-group">
          <label>メールアドレス</label>
          <div class="profile-value" th:text="${account.email}"></div>
          <input class="profile-input" type="email" name="email" hidden />
        </div>

        <!-- EMAIL -->
        <div class="profile-group">
          <label>パスワード</label>
          <div class="profile-value">*****************</div>
          <input class="profile-input" type="password" name="password" hidden />
        </div>

        <!-- BUTTONS -->
        <div class="btn-group">
          <button id="editBtn" class="btn edit" onclick="toggleEdit(event)">
            編集
          </button>
          <button id="saveBtn" class="btn edit" type="submit" hidden>
            保存
          </button>
          <button
            id="cancelBtn"
            class="btn back"
            onclick="cancelEdit(event)"
            hidden
          >
            キャンセル
          </button>
          <button class="btn back" onclick="goBack(event)">戻る</button>
        </div>
      </form>
    </div>

    <script>
      /* =====================
		   EDIT MODE
		===================== */
      function toggleEdit(event) {
        event?.preventDefault();

        document.querySelectorAll(".profile-group").forEach((group) => {
          const value = group.querySelector(".profile-value");
          const input = group.querySelector(".profile-input");

          input.value = value.textContent.trim();
          value.hidden = true;
          input.hidden = false;
        });

        document.getElementById("editBtn").hidden = true;
        document.getElementById("saveBtn").hidden = false;
        document.getElementById("cancelBtn").hidden = false;
      }

      /* =====================
		   CANCEL
		===================== */
      function cancelEdit(event) {
        event?.preventDefault();
        document.querySelectorAll(".profile-group").forEach((group) => {
          const value = group.querySelector(".profile-value");
          const input = group.querySelector(".profile-input");

          input.setCustomValidity("");
          input.hidden = true;
          value.hidden = false;
        });

        document.getElementById("editBtn").hidden = false;
        document.getElementById("saveBtn").hidden = true;
        document.getElementById("cancelBtn").hidden = true;
      }

      /* =====================
		   VALIDATION
		===================== */
      function validateInputs(inputs) {
        const asciiRegex = /^[\x00-\x7F]+$/;
        const emailRegex = /^[A-Za-z0-9._-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;
        const fullWidthDotRegex = /[。．]/;
        for (let input of inputs) {
          input.setCustomValidity("");

          // USERNAME
          if (input.name === "username") {
            if (input.value.trim() === "") {
              input.setCustomValidity("ユーザー名を入力してください");
              input.reportValidity();
              return false;
            }

            if (!asciiRegex.test(input.value)) {
              input.setCustomValidity(
                "ユーザー名は半角英数字のみ入力してください",
              );
              input.reportValidity();
              return false;
            }
          }

          // EMAIL
          if (input.name === "email") {
            if (input.value.trim() === "") {
              input.setCustomValidity("メールアドレスを入力してください");
              input.reportValidity();
              return false;
            }

            if (input.value.length > 50) {
              input.setCustomValidity(
                "メールアドレスは50文字以内で入力してください",
              );
              input.reportValidity();
              return false;
            }

            if (!asciiRegex.test(input.value)) {
              input.setCustomValidity(
                "メールアドレスは半角英数字のみ入力してください",
              );
              input.reportValidity();
              return false;
            }

            if (!emailRegex.test(input.value)) {
              input.setCustomValidity("正しいメール形式で入力してください");
              input.reportValidity();
              return false;
            }
          }
        }
        return true;
      }

      /* =====================
		   BACK
		===================== */
      function goBack(event) {
        event?.preventDefault();
        history.back();
      }
    </script>
  </body>
</html>
